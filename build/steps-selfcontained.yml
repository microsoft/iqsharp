##
# Pack IQ# self-contained executable.
##

steps:

##
# Pre-reqs
##
- task: UseDotNet@2
  displayName: 'Use .NET SDK'
  inputs:
    packageType: sdk
    useGlobalJson: true

- task: UsePythonVersion@0
  inputs:
    versionSpec: 3.9
  displayName: 'Use Python 3.9'

- task: DownloadBuildArtifacts@0
  inputs:
    artifactName: iqsharp
    downloadPath: '$(System.DefaultWorkingDirectory)/artifact'

- pwsh: |
    Move-Item "$Env:SYSTEM_DEFAULTWORKINGDIRECTORY/artifact/iqsharp/drops" "$Env:SYSTEM_DEFAULTWORKINGDIRECTORY/drops"
  displayName: "Copy build artifacts to IQ# working directory"

##
# Pack
##
- pwsh: ./pack-selfcontained.ps1
  displayName: "Packing IQ# self-contained executable"
  workingDirectory: '$(System.DefaultWorkingDirectory)/build'

##
# Publish tests results and build artifacts.
##
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: iqsharp'
  condition: succeededOrFailed()
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: iqsharp
