##
# Test IQ# with Selenium.
# Windows build agents have ChromeWebDriver and GeckoWebDriver pre-installed.
##

steps:

##
# Pre-reqs
##
- task: UseDotNet@2
  displayName: 'Use .NET Core SDK'
  inputs:
    packageType: sdk
    useGlobalJson: true

- task: UsePythonVersion@0
  inputs:
    versionSpec: 3.9
  displayName: 'Use Python 3.9'

- pwsh: ./bootstrap.ps1
  displayName: "Bootstrap"
  workingDirectory: '$(System.DefaultWorkingDirectory)'

##
# Install IQ# kernel
##
- script: dotnet run -c %BUILD_CONFIGURATION% -- install --user
  displayName: "Installing IQ#"
  workingDirectory: '$(System.DefaultWorkingDirectory)/src/Tool'

##
# Test
##
- script: |
    start jupyter notebook --no-browser --NotebookApp.base_url=test/path
    pytest -v ./test-selenium.py
  displayName: "Running Selenium tests"
  workingDirectory: '$(System.DefaultWorkingDirectory)/build'
