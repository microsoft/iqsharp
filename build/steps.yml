##
# Build and test IQ#.
##
steps:
- script: ./set-env.sh
  displayName: "Building IQ#"
  workingDirectory: '$(IQSharp.WorkingDirectory)/build'

  
- script: ./build.sh
  displayName: "Building IQ#"
  workingDirectory: '$(IQSharp.WorkingDirectory)/build'


- script: ./test.sh
  displayName: "Testing IQ#"
  workingDirectory: '$(IQSharp.WorkingDirectory)/build'
  condition: and(succeeded(), ne(variables['Skip.Tests'], 'true'))

- task: PublishTestResults@2
  displayName: 'Publish IQ# tests results'
  condition: and(succeededOrFailed(), ne(variables['Skip.Tests'], 'true'))
  inputs:
    testResultsFormat: VSTest
    testResultsFiles: '$(IQSharp.WorkingDirectory)/**/*.trx'
    testRunTitle: 'IQ# Sanity tests'


- script: ./pack.sh
  displayName: "Packing IQ#"
  workingDirectory: '$(IQSharp.WorkingDirectory)/build'